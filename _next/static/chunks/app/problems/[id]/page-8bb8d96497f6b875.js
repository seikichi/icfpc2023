(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[877],{8429:function(e,t,n){"use strict";e.exports=n.p+"static/media/wasm_bg.4ade83ce.wasm"},9695:function(e,t,n){Promise.resolve().then(n.bind(n,653))},653:function(e,t,n){"use strict";let r;n.r(t),n.d(t,{default:function(){return N}});var l=n(9268),i=n(4821),a=n(6006),s=n(209);let o=Array(128).fill(void 0);o.push(void 0,null,!0,!1);let c=o.length,u="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&u.decode();let m=null;function d(){return(null===m||0===m.byteLength)&&(m=new Uint8Array(r.memory.buffer)),m}function h(e,t){return e>>>=0,u.decode(d().subarray(e,e+t))}let f=0,g="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},_="function"==typeof g.encodeInto?function(e,t){return g.encodeInto(e,t)}:function(e,t){let n=g.encode(e);return t.set(n),{read:e.length,written:n.length}};function b(e,t,n){if(void 0===n){let n=g.encode(e),r=t(n.length,1)>>>0;return d().subarray(r,r+n.length).set(n),f=n.length,r}let r=e.length,l=t(r,1)>>>0,i=d(),a=0;for(;a<r;a++){let t=e.charCodeAt(a);if(t>127)break;i[l+a]=t}if(a!==r){0!==a&&(e=e.slice(a)),l=n(l,r,r=a+3*e.length,1)>>>0;let t=d().subarray(l+a,l+r),i=_(e,t);a+=i.written}return f=a,l}let x=null;function w(){return(null===x||0===x.byteLength)&&(x=new Int32Array(r.memory.buffer)),x}let y=null;async function p(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(t){if("application/wasm"!=e.headers.get("Content-Type"))console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t);else throw t}let n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}{let n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}async function j(e){if(void 0!==r)return r;void 0===e&&(e=new n.U(n(8429)));let t=function(){let e={};return e.wbg={},e.wbg.__wbg_alert_e63a4c41bbd7a3e9=function(e,t){alert(h(e,t))},e.wbg.__wbg_new_abda76e883ba8a5f=function(){let e=Error();return function(e){c===o.length&&o.push(o.length+1);let t=c;return c=o[t],o[t]=e,t}(e)},e.wbg.__wbg_stack_658279fe44541cf6=function(e,t){let n=o[t].stack,l=b(n,r.__wbindgen_malloc,r.__wbindgen_realloc),i=f;w()[e/4+1]=i,w()[e/4+0]=l},e.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,l;try{n=e,l=t,console.error(h(e,t))}finally{r.__wbindgen_free(n,l,1)}},e.wbg.__wbindgen_object_drop_ref=function(e){var t;o[t=e],t<132||(o[t]=c,c=t)},e}();("string"==typeof e||"function"==typeof Request&&e instanceof Request||"function"==typeof URL&&e instanceof URL)&&(e=fetch(e));let{instance:l,module:i}=await p(await e,t);return r=l.exports,j.__wbindgen_wasm_module=i,y=null,x=null,m=null,r}function S(e){let{problemId:t,solution:n,setSolution:o}=e,c=(0,a.useRef)(null),u=(0,a.useRef)(null),[m,d]=(0,a.useState)(null),[h,g]=(0,a.useState)(null),[_,x]=(0,a.useState)(null),p=e.room;function S(e,t,n){let r,l,i;return e>0?(r=l=255*(1-e/n),i=255):e<0?(r=255,l=i=255*(1-e/t)):r=l=i=255,"rgb("+Math.round(r)+","+Math.round(l)+","+Math.round(i)+")"}(0,a.useEffect)(()=>{null!==p&&null!==n&&(console.log("start calculate"),(async()=>{let e=JSON.stringify(p),l=JSON.stringify({placements:n.placements.map(e=>{let{x:t,y:n}=e;return[t,n]})});try{await j();let i=function(e,t,n){let l=b(e,r.__wbindgen_malloc,r.__wbindgen_realloc),i=f,a=b(t,r.__wbindgen_malloc,r.__wbindgen_realloc),s=f,o=r.calculate(l,i,a,s,n);return o}(e,l,t);d(Number(i));let a=p.musicians.map((n,i)=>{let a=function(e,t,n,l){try{let c=r.__wbindgen_add_to_stack_pointer(-16),u=b(e,r.__wbindgen_malloc,r.__wbindgen_realloc),m=f,d=b(t,r.__wbindgen_malloc,r.__wbindgen_realloc),h=f;r.calculate_score_of_a_musician(c,u,m,d,h,n,l);var i,a=w()[c/4+0],s=w()[c/4+1],o=(i=a>>>0,((null===y||0===y.byteLength)&&(y=new BigInt64Array(r.memory.buffer)),y).subarray(i/8,i/8+s)).slice();return r.__wbindgen_free(a,8*s),o}finally{r.__wbindgen_add_to_stack_pointer(16)}}(e,l,t,i);return a.reduce((e,t)=>e+Number(t),0)});console.log("musician_scores:",n.placements.map((e,t)=>{let{x:n,y:r}=e;return{x:n,y:r,score:a[t]}})),g(a);let s=JSON.stringify({size:[p.room_width,p.room_height],stage_pos:p.stage_bottom_left,stage_size:[p.stage_width,p.stage_height]}),o=p.attendees.map((e,t)=>{let n=JSON.stringify(e);return function(e,t){let n=b(e,r.__wbindgen_malloc,r.__wbindgen_realloc),l=f,i=b(t,r.__wbindgen_malloc,r.__wbindgen_realloc),a=f,s=r.attendee_importance(n,l,i,a);return s}(n,s)});x(o)}catch(e){alert(JSON.stringify(e))}})())},[p,n,t]),(0,a.useEffect)(()=>{if(null===c.current||null===p)return;let e=c.current,t=e.getContext("2d");t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,e.width,e.height);let r=1e3/Math.max(p.room_width,p.room_height);e.width=p.room_width*r,e.height=p.room_height*r,t.scale(r,r),t.fillStyle="gray",t.fillRect(0,0,p.room_width,p.room_height),t.fillStyle="green";let[l,i]=p.stage_bottom_left;if(t.fillRect(l,i,p.stage_width,p.stage_height),p.attendees.forEach((e,n)=>{let{x:r,y:l}=e;if(null===_)t.fillStyle="red";else{let e=S(_[n],Math.min(..._),Math.max(..._));t.fillStyle=e}let i=new Path2D;i.arc(r,l,5,0,2*Math.PI),t.fill(i)}),t.fillStyle="black",p.pillars)for(let{center:e,radius:n}of p.pillars){let[r,l]=e,i=new Path2D;i.arc(r,l,n,0,2*Math.PI),t.fill(i)}null!==n&&n.placements.forEach((e,n)=>{let{x:r,y:l}=e;if(null===h)t.fillStyle="white";else{let e=S(h[n],Math.min(...h),Math.max(...h));t.fillStyle=e}let i=new Path2D;i.arc(r,l,5,0,2*Math.PI),t.fill(i)})},[c,p,n,h,_]);let z=(0,a.useCallback)(()=>{o(null),d(null),g(null)},[o]),A=(0,a.useCallback)(()=>{null!==u.current&&u.current.click()},[u]),N=(0,a.useCallback)(e=>{let t=e.target.files[0],n=new FileReader;n.onload=e=>{try{let t=e.target.result,n=s.WQ.parse(JSON.parse(t));o(n),d(null),console.log(n)}catch(e){alert(JSON.stringify(e))}},n.readAsText(t)},[o]);return(0,l.jsxs)(i.Zb,{className:"mt-8",children:[(0,l.jsxs)(i.Dx,{children:["Problem: ",t]}),m&&(0,l.jsxs)(i.xv,{children:["Score: ",m]}),(0,l.jsx)("canvas",{width:1e3,height:1e3,ref:c}),(0,l.jsxs)(i.kC,{justifyContent:"end",className:"space-x-2 border-t pt-4 mt-8",children:[(0,l.jsx)(i.zx,{size:"xs",variant:"secondary",onClick:z,children:"Clear Solution"}),(0,l.jsx)("input",{type:"file",onChange:N,ref:u,style:{display:"none"}}),(0,l.jsx)(i.zx,{size:"xs",variant:"primary",onClick:A,children:"Select Solution"})]})]})}function z(e){let{setSolution:t}=e,n=(0,a.useCallback)(e=>{(async()=>{try{let n=await fetch("/solutions/".concat(e),{mode:"cors"});if(!n.ok)throw Error(n.statusText);t(s.WQ.parse(await n.json()))}catch(e){alert(JSON.stringify(e))}})()},[t]);return(0,l.jsx)(i.Zb,{children:(0,l.jsxs)(i.iA,{children:[(0,l.jsx)(i.ss,{children:(0,l.jsxs)(i.SC,{children:[(0,l.jsx)(i.xs,{className:"text-right",children:"Challenge ID"}),(0,l.jsx)(i.xs,{className:"text-right",children:"Score"}),(0,l.jsx)(i.xs,{className:"text-right",children:"Args"}),(0,l.jsx)(i.xs,{className:"text-right",children:"Elapsed (sec)"}),(0,l.jsx)(i.xs,{className:"text-right",children:"Commit ID"}),(0,l.jsx)(i.xs,{className:"text-right",children:"Solution"}),(0,l.jsx)(i.xs,{className:"text-right",children:"Created At"}),(0,l.jsx)(i.xs,{className:"text-right",children:"Submission ID"})]})}),(0,l.jsx)(i.RM,{children:e.solutions.map(e=>(0,l.jsxs)(i.SC,{children:[(0,l.jsx)(i.pj,{children:(0,l.jsx)("a",{href:"/challenges/".concat(e.challengeId,".html"),children:e.challengeId})}),(0,l.jsx)(i.pj,{className:"text-right",children:Number(e.score)}),(0,l.jsx)(i.pj,{className:"text-left",children:e.args}),(0,l.jsx)(i.pj,{className:"text-right",children:e.elapsedSec}),(0,l.jsx)(i.pj,{className:"text-right",children:(0,l.jsx)("a",{href:"https://github.com/seikichi/icfpc2023/commit/".concat(e.commitId),children:e.commitId})}),(0,l.jsx)(i.pj,{className:"text-right",children:(0,l.jsx)(i.zx,{size:"xs",variant:"primary",onClick:()=>n(e.bucketKey),children:"Select Solution"})}),(0,l.jsx)(i.pj,{className:"text-left",children:e.createdAt.toISOString()}),(0,l.jsx)(i.pj,{className:"text-right",children:JSON.parse(e.submissionId||"null")})]},e.id))})]})})}function A(e){let t=e.solutions.slice().sort((e,t)=>e.createdAt.getTime()-t.createdAt.getTime()),n=0,r=[];for(let e of t)n=Math.max(n,Number(e.score)),r.push({score:n,createdAt:e.createdAt.toISOString()});return(0,l.jsxs)(i.Zb,{className:"mt-8",children:[(0,l.jsx)(i.Dx,{children:"Max Score History"}),(0,l.jsx)(i.xv,{children:"X 軸の間隔は適当"}),(0,l.jsx)(i.wW,{className:"mt-6 h-80",data:r,index:"createdAt",colors:["indigo"],categories:["score"]})]})}function N(e){let{solutions:t}=e,[n,r]=(0,a.useState)(null);return(0,l.jsxs)("div",{className:"space-y-4 mt-8",children:[(0,l.jsx)(A,{solutions:t}),(0,l.jsx)(S,{problemId:e.problemId,solution:n,setSolution:r,room:e.room}),(0,l.jsx)(z,{solutions:t,setSolution:r})]})}},209:function(e,t,n){"use strict";n.d(t,{Hg:function(){return i},WQ:function(){return l}});var r=n(2391);r.z.object({DATABASE_URL:r.z.string().startsWith("mysql://"),AUTH_USER:r.z.string().optional(),AUTH_PASSWORD:r.z.string().optional(),AWS_ACCESS_KEY_ID:r.z.string().startsWith("AKIA"),AWS_SECRET_ACCESS_KEY:r.z.string().min(1),AWS_DEFAULT_REGION:r.z.string().min(1),SOLVER_LAMBDA_ARN:r.z.string().startsWith("arn:aws:lambda:"),CHALLENGE_LAMBDA_ARN:r.z.string().startsWith("arn:aws:lambda:"),BUCKET:r.z.string().min(1),API_TOKEN:r.z.string().min(1)}),r.z.object({room_width:r.z.number().gt(0),room_height:r.z.number().gt(0),stage_width:r.z.number().gt(0),stage_height:r.z.number().gt(0),stage_bottom_left:r.z.tuple([r.z.number().min(0),r.z.number().min(0)]),musicians:r.z.number().min(0).array().min(1),attendees:r.z.object({x:r.z.number(),y:r.z.number(),tastes:r.z.number().array().min(1)}).array().min(1),pillars:r.z.object({center:r.z.tuple([r.z.number().min(0),r.z.number().min(0)]),radius:r.z.number().min(0)}).array().min(0).optional()});let l=r.z.object({placements:r.z.object({x:r.z.number(),y:r.z.number()}).array().min(1)}),i=r.z.object({tag:r.z.string().min(1).max(16).regex(/^[a-zA-Z0-9\-]*$/),args:r.z.string().min(1).max(256),target:r.z.string().min(1).max(32).regex(/^([1-9][0-9]*(-[1-9][0-9]*)?)(,([1-9][0-9]*(-[1-9][0-9]*)?))*$/)})}},function(e){e.O(0,[795,391,253,769,744],function(){return e(e.s=9695)}),_N_E=e.O()}]);